# URL Generation Utility

This document explains how to use the URL generation utility to fix mixed content errors where HTTPS frontend is trying to load data from an insecure HTTP API endpoint.

## Overview

The URL generation utility provides functions to generate absolute URLs with the correct protocol (HTTP or HTTPS) based on the application's configuration settings. This ensures that all URLs generated by the API use the same protocol as the frontend, preventing mixed content errors.

## Functions

### `generate_url(path: str) -> str`

This function takes a relative URL path and generates an absolute URL with the appropriate protocol (HTTP or HTTPS) based on the application settings.

**Parameters:**
- `path`: Relative URL path (should start with '/')

**Returns:**
- Absolute URL with the correct protocol

**Example:**
```python
from app.api.deps import generate_url

# Generate an absolute URL for the products endpoint
products_url = generate_url("/api/v1/products")
# Result: "https://example.com/api/v1/products" (if USE_HTTPS is True)
# Result: "http://example.com/api/v1/products" (if USE_HTTPS is False)
```

### `get_base_url() -> str`

This dependency function can be injected into API endpoints to get the base URL with the appropriate protocol (HTTP or HTTPS) based on the application settings.

**Returns:**
- Base URL with the correct protocol

**Example:**
```python
from fastapi import Depends
from app.api.deps import get_base_url

@router.get("/")
async def get_example(base_url: str = Depends(get_base_url)):
    return {"base_url": base_url}
```

## Configuration

The URL generation utility uses the following settings from `app.core.config`:

- `SERVER_NAME`: The server name or domain name
- `USE_HTTPS`: Boolean flag indicating whether to use HTTPS (True) or HTTP (False)

These settings are used to generate the base URL with the correct protocol.

## Usage in API Endpoints

Here's an example of how to use the URL generation utility in an API endpoint:

```python
from typing import Dict
from fastapi import APIRouter, Depends, Request
from app.api.deps import get_base_url, generate_url

router = APIRouter()

@router.get("/")
async def get_example_urls(
    request: Request,
    base_url: str = Depends(get_base_url)
) -> Dict[str, str]:
    return {
        "base_url": base_url,
        "products_url": generate_url("/api/v1/products"),
        "orders_url": generate_url("/api/v1/orders"),
        "current_url": generate_url(request.url.path)
    }
```

## Best Practices

1. Always use the URL generation utility when returning URLs in API responses
2. Use the `get_base_url` dependency when you need the base URL in multiple places within an endpoint
3. Use the `generate_url` function when you need to generate a specific URL
4. Make sure the `SERVER_NAME` and `USE_HTTPS` settings are correctly configured in your environment